<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازی متنی هوش مصنوعی و انسان</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Merriweather:wght@400;700&family=Share+Tech+Mono&family=Orbitron:wght@400..900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* [تمام کدهای CSS که فرستادید در اینجا قرار می‌گیرد - بدون تغییر] */
        html, body, #app { height: 100%; margin: 0; padding: 0; overflow: hidden; transition: background-color 0.8s ease-in-out, color 0.8s ease-in-out; }
        .classic-card, .classic-btn, input, select, .app-header, .lobby-header, .app-footer, .lobby-footer, .lobby-item, .lobby-chat-container, .chat-message, .game-player-pod, .voting-btn, .lobby-type-btn { transition: background 0.8s ease-in-out, background-color 0.8s ease-in-out, color 0.8s ease-in-out, border-color 0.8s ease-in-out, box-shadow 0.8s ease-in-out, transform 0.3s ease; }
        #loading-screen { background-color: #050510; overflow: hidden; }
        .loading-screen-container { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #binary-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; font-family: 'Share Tech Mono', monospace; color: rgba(0, 255, 13, 0.2); font-size: 14px; white-space: pre-wrap; word-wrap: break-word; overflow: hidden; z-index: 1; user-select: none; }
        .magnifying-glass { position: absolute; z-index: 3; animation: magnify-roam 15s infinite alternate ease-in-out; }
        .glass-lens { width: 180px; height: 180px; border-radius: 50%; border: 15px solid #888; background-color: rgba(255, 255, 255, 0.1); box-shadow: 0 0 30px rgba(255, 255, 255, 0.5), inset 0 0 15px rgba(0, 0, 0, 0.5); position: relative; overflow: hidden; backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px); }
        .glass-lens .icon-human, .glass-lens .icon-ai { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; color: #00FF85; animation-duration: 6s; animation-iteration-count: infinite; animation-timing-function: ease-in-out; opacity: 0; }
        .glass-lens .icon-human { animation-name: fade-icons-A; }
        .glass-lens .icon-ai { animation-name: fade-icons-B; }
        .glass-handle { width: 30px; height: 100px; background: linear-gradient(#666, #333); position: absolute; bottom: -60px; right: -60px; transform: rotate(-45deg); border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.7); }
        .loading-text-container { z-index: 2; text-align: center; }
        #loading-main-text { font-family: 'Share Tech Mono', monospace; font-size: 2.5rem; color: #DAA520; text-shadow: 0 0 10px #FFD700; border-right: .15em solid #FFD700; white-space: nowrap; overflow: hidden; animation: typing 3s steps(30, end) infinite alternate, blink-caret .75s step-end infinite; margin: 0 auto; letter-spacing: .15em; }
        #loading-sub-text { font-family: 'Merriweather', serif; color: #E0E0E0; font-size: 1.2rem; margin-top: 1rem; opacity: 0; animation: fade-in-slow 4s forwards; animation-delay: 1s; }
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: #FFD700; } }
        @keyframes magnify-roam { 0% { top: 20%; left: 15%; transform: rotate(0deg); } 25% { top: 50%; left: 70%; transform: rotate(20deg); } 50% { top: 60%; left: 25%; transform: rotate(-10deg); } 75% { top: 30%; left: 80%; transform: rotate(5deg); } 100% { top: 20%; left: 15%; transform: rotate(0deg); } }
        @keyframes fade-icons-A { 0%, 45% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 50%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); } }
        @keyframes fade-icons-B { 0%, 50% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); } 55%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
        @keyframes fade-in-slow { to { opacity: 0.8; } }
        body.theme-classic { font-family: 'Merriweather', serif; background: radial-gradient(ellipse at bottom, #100C08 0%, #000000 100%); color: #E0E0E0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        body.theme-classic h1, body.theme-classic h2 { font-family: 'Playfair Display', serif; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        body.theme-classic .classic-card { background: linear-gradient(145deg, #4B0000 0%, #660000 60%, #800000 100%); border: 4px solid #DAA520; box-shadow: 0 15px 30px rgba(0,0,0,0.6), inset 0 0 15px rgba(255,255,255,0.1); }
        body.theme-classic .classic-card::before, body.theme-classic .classic-card::after { border-color: #FFD700; box-shadow: 0 0 10px rgba(255,215,0,0.5); }
        body.theme-classic .classic-btn { border: 2px solid #DAA520; box-shadow: 0 8px 16px rgba(0,0,0,0.4), inset 0 0 8px rgba(255,255,255,0.1); color: #FFFFFF; }
        body.theme-classic .classic-btn:hover { box-shadow: 0 12px 24px rgba(0,0,0,0.6), inset 0 0 10px rgba(255,255,255,0.2); }
        body.theme-classic .btn-purple-classic { background: linear-gradient(145deg, #8A2BE2 0%, #6A0DAD 100%); }
        body.theme-classic .btn-blue-classic { background: linear-gradient(145deg, #4682B4 0%, #2A52BE 100%); }
        body.theme-classic .btn-green-classic { background: linear-gradient(145deg, #228B22 0%, #006400 100%); }
        body.theme-classic .btn-red-classic { background: linear-gradient(145deg, #CD5C5C 0%, #B22222 100%); }
        body.theme-classic .btn-gray-classic { background: linear-gradient(145deg, #A9A9A9 0%, #808080 100%); }
        body.theme-classic .btn-brown-classic { background: linear-gradient(145deg, #8B4513 0%, #69320E 100%); }
        body.theme-classic input, body.theme-classic select { background-color: #202020; border: 2px solid #5A5A5A; color: #E0E0E0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); }
        body.theme-classic input:focus, body.theme-classic select:focus { border-color: #DAA520 !important; box-shadow: 0 0 0 4px rgba(218, 165, 32, 0.5) !important, inset 0 2px 4px rgba(0,0,0,0.5) !important; }
        body.theme-classic .app-header, body.theme-classic .lobby-header { background: linear-gradient(to right, #4A2B00 0%, #7A4C00 50%, #4A2B00 100%); border-bottom: 3px solid #FFD700; box-shadow: 0 8px 20px rgba(0,0,0,0.7); }
        body.theme-classic #header-user-coins-container { background-color: rgba(0,0,0,0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.3); color: #FFD700; }
        body.theme-classic .lobby-header .search-container { background-color: #303030; border: 2px solid #5A5A5A; }
        body.theme-classic .lobby-header .search-container svg { color: #DAA520; }
        body.theme-classic .app-footer, body.theme-classic .lobby-footer { background: linear-gradient(to left, #4A2B00 0%, #7A4C00 50%, #4A2B00 100%); border-top: 3px solid #FFD700; box-shadow: 0 -8px 20px rgba(0,0,0,0.7); }
        body.theme-classic .lobby-footer .icon-btn { color: #FFD700; }
        body.theme-classic .main-content-area { background: linear-gradient(180deg, #2C2C2C 0%, #1A1A1A 100%); }
        body.theme-classic .lobby-item { background: linear-gradient(145deg, #2A2A2A 0%, #1A1A1A 100%); border: 2px solid #DAA520; box-shadow: 0 8px 16px rgba(0,0,0,0.5), inset 0 0 10px rgba(255,215,0,0.1); }
        body.theme-classic .lobby-item:hover { box-shadow: 0 15px 25px rgba(0,0,0,0.6), inset 0 0 12px rgba(255,215,0,0.2); }
        body.theme-classic .lobby-item h3 { color: #FFD700; }
        body.theme-classic .lobby-detail-content { background: linear-gradient(145deg, #1A1A1A 0%, #0D0D0D 100%); border: 3px solid #DAA520; box-shadow: 0 10px 20px rgba(0,0,0,0.7); }
        body.theme-classic .lobby-sidebar { background-color: rgba(0,0,0,0.3); border: 1px solid #444; }
        body.theme-classic .player-list-item { background-color: rgba(255, 255, 255, 0.05); border: 1px solid transparent; }
        body.theme-classic .player-list-item.is-host { border-color: #FFD700; }
        body.theme-classic .kick-player-btn { border: 1px solid #B22222; color: #B22222; }
        body.theme-classic .kick-player-btn:hover { background: #B22222; color: white; }
        body.theme-classic .lobby-chat-container { background-color: rgba(0,0,0,0.4); border: 2px solid #5A5A5A; }
        body.theme-classic .chat-message { background-color: #333; }
        body.theme-classic .chat-message.current-user { background-color: #4682B4; }
        body.theme-classic .chat-message .sender-name { color: #FFD700; }
        body.theme-classic .start-game-btn { background: linear-gradient(145deg, #228B22 0%, #006400 100%); border: 2px solid #DAA520; }
        body.theme-classic .lobby-sidebar::-webkit-scrollbar-thumb, body.theme-classic #player-list-container::-webkit-scrollbar-thumb, body.theme-classic .lobby-chat-messages::-webkit-scrollbar-thumb, body.theme-classic .custom-scrollbar::-webkit-scrollbar-thumb { background: #DAA520; }
        body.theme-classic .lobby-type-btn { border: 2px solid #DAA520; background-color: transparent; color: #DAA520; }
        body.theme-classic .lobby-type-btn.active { background-color: #DAA520; color: #1A1A1A; box-shadow: 0 0 10px rgba(255,215,0,0.5); }
        body.theme-classic .coin-icon { fill: #FFD700; }
        .page-transition-active { transition: opacity 0.6s ease-in-out; }
        .page-transition-hidden { opacity: 0; }
        .page-transition-visible { opacity: 1; }
        .classic-card { border-radius: 20px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); position: relative; max-height: 90vh; overflow-y: auto; }
        .classic-card::before { content: ''; position: absolute; top: -10px; left: -10px; width: 30px; height: 30px; border-top: 5px solid; border-left: 5px solid; border-radius: 5px 0 0 0; }
        .classic-card::after { content: ''; position: absolute; bottom: -10px; right: -10px; width: 30px; height: 30px; border-bottom: 5px solid; border-right: 5px solid; border-radius: 0 0 5px 0; }
        .classic-btn { border-radius: 15px; font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); color: #FFFFFF; padding: 0.875rem 1.5rem; font-size: 1.125rem; position: relative; overflow: hidden; }
        .classic-btn:hover { transform: translateY(-5px) scale(1.03); }
        .classic-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        input, select { padding: 0.875rem; border-radius: 0.75rem; }
        .app-header { height: 70px; position: fixed; top: 0; left: 0; right: 0; z-index: 40; padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; }
        #header-user-coins-container { border-radius: 10px; padding: 0.5rem 1rem; transition: all 0.3s ease; margin-left: 1rem; }
        .lobby-header { height: 70px; position: fixed; top: 0; left: 0; right: 0; z-index: 40; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: center; }
        .lobby-header .search-container { display: flex; flex-grow: 1; max-width: 600px; margin: 0 auto; align-items: center; border-radius: 15px; padding: 0.5rem 1rem; }
        .lobby-header .search-container input { flex-grow: 1; background-color: transparent; border: none; padding: 0.25rem 0.5rem; outline: none; text-align: right; }
        .app-footer, .lobby-footer { height: 90px; position: fixed; bottom: 0; left: 0; right: 0; z-index: 40; padding: 1rem; display: flex; justify-content: space-around; align-items: center; }
        .main-content-area { padding-top: 70px; padding-bottom: 90px; flex-grow: 1; overflow-y: auto; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .profile-modal-overlay { background-color: rgba(0,0,0,0.7); transition: opacity 0.3s ease-in-out; }
        .lobby-item { border-radius: 15px; transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); position: relative; overflow: hidden; padding: 1.25rem 1.5rem; display: flex; flex-direction: column; justify-content: space-between; align-items: center; text-align: center; }
        .lobby-item:hover { transform: translateY(-8px) scale(1.02); }
        .lobby-detail-content { border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.7); padding: 1.5rem; width: 95%; max-width: 1200px; height: calc(100% - 100px); display: flex; flex-direction: row; gap: 1.5rem; margin: 50px auto; overflow: hidden; }
        .lobby-sidebar { display: flex; flex-direction: column; flex-shrink: 0; width: 300px; border-radius: 15px; padding: 1rem; overflow-y: auto; }
        .lobby-main-panel { position: relative; display: flex; flex-direction: column; flex-grow: 1; min-width: 0; overflow: hidden; }
        #player-list-container { margin-top: 1rem; flex-grow: 1; overflow-y: auto; }
        .player-list-item { border-radius: 8px; padding: 0.75rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .kick-player-btn { background: none; border-radius: 5px; padding: 0.2rem 0.5rem; font-size: 0.8rem; cursor: pointer; }
        .lobby-chat-container { border-radius: 10px; padding: 0.75rem; flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        .lobby-chat-messages { flex-grow: 1; overflow-y: auto; padding-right: 0.5rem; display: flex; flex-direction: column; }
        .chat-message { padding: 0.5rem 0.75rem; border-radius: 10px; margin-bottom: 0.5rem; max-width: 80%; word-wrap: break-word; align-self: flex-start; }
        .chat-message.current-user { align-self: flex-end; }
        .lobby-chat-input-form { margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-shrink: 0; }
        .lobby-actions-footer { flex-shrink: 0; margin-top: 1rem; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 1rem; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        @media (min-width: 640px) { .lobby-item { flex-direction: row; text-align: right; } .lobby-item .lobby-actions { flex-direction: row; width: auto; margin-top: 0; } }
        @media (max-width: 860px) {
            .lobby-detail-content {
                flex-direction: column;
                height: calc(100% - 80px);
                margin: 40px auto;
                padding: 1rem;
                overflow: hidden;
            }
            .lobby-sidebar { width: 100%; flex-shrink: 0; max-height: 250px; }
            .lobby-main-panel { flex-grow: 1; min-height: 0; }
        }
    </style>
</head>
<body class="theme-classic">

    <div id="app" class="relative w-full h-full flex justify-center items-center">
        <!-- Loading Screen -->
        <div id="loading-screen" class="absolute inset-0 flex flex-col justify-center items-center z-50 page-transition-visible">
            <div class="loading-screen-container">
                <div id="binary-background"></div>
                <div class="magnifying-glass">
                    <div class="glass-lens">
                        <svg class="icon-human" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <svg class="icon-ai" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect width="16" height="16" x="4" y="4" rx="2" /><rect width="6" height="6" x="9" y="9" rx="1" /><path d="M9 2v2M15 2v2M9 20v2M15 20v2M20 9h2M20 14h2M2 9h2M2 14h2" /></svg>
                    </div>
                    <div class="glass-handle"></div>
                </div>
                <div class="loading-text-container">
                    <h1 id="loading-main-text">در حال بارگذاری...</h1>
                    <p id="loading-sub-text">لطفا کمی صبر کنید.</p>
                </div>
            </div>
        </div>

        <!-- Authentication Screen -->
        <div id="auth-screen" class="hidden absolute inset-0 flex justify-center items-center z-40">
            <div class="classic-card p-8 w-11/12 max-w-md text-center">
                <h2 class="text-3xl font-bold mb-6">ورود / ثبت نام</h2>
                <form id="auth-form" class="space-y-5">
                    <input type="tel" id="phone-number" placeholder="شماره تلفن" class="w-full" required>
                    <div id="display-name-field" class="hidden">
                        <input type="text" id="display-name" placeholder="نام نمایشی" class="w-full">
                    </div>
                    <input type="password" id="password" placeholder="رمز عبور" class="w-full" required>
                    <div class="flex space-x-4 space-x-reverse mt-6">
                        <button type="button" id="login-toggle-btn" class="w-1/2 classic-btn btn-blue-classic">ورود</button>
                        <button type="button" id="register-toggle-btn" class="w-1/2 classic-btn btn-green-classic">ثبت نام</button>
                    </div>
                    <button type="submit" id="submit-auth-btn" class="w-full mt-4 classic-btn btn-purple-classic text-xl">ادامه</button>
                </form>
                <div id="message-box" class="mt-5 p-3.5 rounded-xl text-center hidden"></div>
            </div>
        </div>
        
        <!-- Main Screen, Lobby Screen, Modals etc. go here -->
        <!-- [تمام کدهای HTML دیگر که فرستادید در اینجا قرار می‌گیرد - بدون تغییر] -->
        <div id="main-screen" class="hidden absolute inset-0 flex flex-col z-30">
            <header class="app-header"><div id="profile-summary" class="flex items-center space-x-2 space-x-reverse cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="lucide lucide-user-circle"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg><div><span id="header-display-name" class="font-bold">نام کاربری</span><span id="header-user-id" class="text-xs">ID: ---</span></div></div><div class="flex-grow"></div><div id="header-user-coins-container" class="flex items-center text-xl"><svg class="coin-icon w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8zm-2-10h4a1 1 0 0 0 0-2h-4a1 1 0 0 0 0 2zm0 4h4a1 1 0 0 0 0-2h-4a1 1 0 0 0 0 2z"/></svg><span id="header-user-coins">---</span></div><button id="menu-btn" class="p-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg></button></header>
            <div class="main-content-area justify-center"><h1 class="text-4xl font-bold mb-8">به بازی متنی خوش آمدید!</h1><p class="text-lg">لطفاً یکی از گزینه‌های زیر را انتخاب کنید.</p></div>
            <footer class="app-footer"><button id="friendly-game-btn" class="classic-btn btn-purple-classic">بازی دوستانه</button><button id="rated-game-btn" class="classic-btn btn-brown-classic">بازی امتیازی</button></footer>
        </div>
        <div id="lobby-screen" class="hidden absolute inset-0 flex flex-col z-30">
            <header class="lobby-header"><div class="search-container"><button id="back-to-main-btn" class="p-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg></button><input type="text" id="lobby-search-input" placeholder="جستجو..." class="flex-grow"><button id="search-lobbies-btn" class="p-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></button></div></header>
            <div class="main-content-area p-4"><div class="max-w-xl mx-auto w-full"><h2 class="text-2xl font-bold mb-4">لیست لابی‌ها</h2><div id="lobbies-list" class="space-y-3"><p>در حال بارگذاری...</p></div></div></div>
            <footer class="lobby-footer"><button id="add-icon-btn" class="classic-btn btn-green-classic">ایجاد لابی</button><button id="refresh-lobbies-btn" class="classic-btn btn-blue-classic">بروزرسانی</button></footer>
        </div>
        <div id="main-menu-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card profile-modal-content p-8 w-11/12 max-w-md text-center relative"><button id="close-main-menu-modal-btn" class="absolute top-4 left-4">&times;</button><div id="main-menu-nav" class="space-y-4"><h2 class="text-3xl font-bold mb-6">منوی اصلی</h2><button id="show-profile-btn" class="w-full classic-btn btn-blue-classic">پروفایل</button><button id="show-themes-btn" class="w-full classic-btn btn-green-classic">انتخاب تم</button><button id="main-menu-logout-btn" class="w-full classic-btn btn-red-classic">خروج</button></div><div id="profile-view" class="hidden text-lg space-y-4"><h2 class="text-3xl font-bold mb-6">پروفایل</h2><p><strong>نام:</strong> <span id="profile-display-name">---</span></p><p><strong>شناسه:</strong> <span id="profile-uid">---</span></p><p><strong>سکه‌ها:</strong> <span id="profile-coins">---</span></p><button id="back-to-main-menu-from-profile" class="w-full classic-btn btn-gray-classic">بازگشت</button></div><div id="themes-view" class="hidden text-lg space-y-4"><h2 class="text-3xl font-bold mb-6">انتخاب تم</h2><div id="theme-buttons-container" class="grid grid-cols-2 gap-4"></div><button id="back-to-main-menu-from-themes" class="w-full classic-btn btn-gray-classic">بازگشت</button></div></div></div>
        <div id="create-lobby-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 class="text-3xl font-bold mb-6">ساخت لابی</h2><button id="close-create-lobby-modal-btn" class="absolute top-4 left-4">&times;</button><form id="create-lobby-form" class="space-y-5"><input type="text" id="new-lobby-name-input" placeholder="نام لابی" class="w-full" required><div id="lobby-type-toggle"><label><input type="radio" name="lobby-type" value="public" checked> عمومی</label><label><input type="radio" name="lobby-type" value="private"> خصوصی</label></div><div id="new-lobby-password-field" class="hidden"><input type="password" id="new-lobby-password-input" placeholder="رمز عبور" class="w-full"></div><div id="lobby-max-players-toggle"><label><input type="radio" name="lobby-max-players" value="4" checked> 4 نفره</label><label><input type="radio" name="lobby-max-players" value="8"> 8 نفره</label></div><button type="submit" id="submit-create-lobby-btn" class="w-full classic-btn btn-green-classic">ساخت</button></form><div id="create-lobby-message-box" class="mt-5 hidden"></div></div></div>
        <div id="custom-confirm-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 id="confirm-title" class="text-3xl font-bold mb-6">تایید</h2><p id="confirm-message" class="mb-8">آیا مطمئن هستید؟</p><div class="flex justify-around"><button id="confirm-yes-btn" class="classic-btn btn-red-classic">بله</button><button id="confirm-no-btn" class="classic-btn btn-gray-classic">خیر</button></div></div></div>
        <div id="lobby-detail-screen" class="hidden absolute inset-0 z-30 lobby-detail-screen-full"><div class="lobby-detail-content"><div class="lobby-sidebar"><h2 id="detail-lobby-name">نام لابی</h2><p id="detail-host-name">سازنده: ---</p><p id="detail-player-count">بازیکنان: 0/4</p><div id="player-list-container"></div></div><div class="lobby-main-panel"><div class="lobby-chat-container"><div id="lobby-chat-messages"></div><form id="lobby-chat-form" class="lobby-chat-input-form"><input type="text" id="lobby-chat-input" placeholder="پیام..." class="flex-grow"><button type="submit" id="lobby-chat-send-btn" class="classic-btn btn-blue-classic">ارسال</button></form></div><div class="lobby-actions-footer"><div id="host-actions-container" style="display: none;"><button id="start-game-btn" class="classic-btn start-game-btn" disabled>شروع بازی</button><button id="view-kicked-players-btn" class="classic-btn btn-brown-classic">اخراجی‌ها</button></div><button id="leave-lobby-btn" class="classic-btn btn-red-classic">خروج از لابی</button></div></div></div></div>
        <div id="kick-player-confirm-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 class="text-3xl font-bold mb-6">اخراج بازیکن</h2><p class="mb-8">اخراج <span id="kick-player-confirm-name" class="font-bold"></span>؟</p><div class="flex justify-around"><button id="kick-player-confirm-btn" class="classic-btn btn-red-classic">اخراج</button><button id="cancel-kick-player-btn" class="classic-btn btn-gray-classic">انصراف</button></div></div></div>
        <div id="kicked-message-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 class="text-3xl font-bold mb-6">شما اخراج شدید</h2><p class="mb-8">شما از لابی <span id="kicked-lobby-name" class="font-bold"></span> اخراج شدید.</p><button id="kicked-message-ok-btn" class="classic-btn btn-blue-classic">باشه</button></div></div>
        <div id="kicked-players-list-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 class="text-3xl font-bold mb-6">لیست اخراجی‌ها</h2><button id="close-kicked-players-list-modal-btn" class="absolute top-4 left-4">&times;</button><div id="kicked-players-list-content" class="space-y-4 mb-8"></div><button id="kicked-list-ok-btn" class="w-full classic-btn btn-gray-classic">بستن</button></div></div>
        <div id="enter-password-modal" class="hidden fixed inset-0 flex justify-center items-center z-50 profile-modal-overlay"><div class="classic-card p-8 w-11/12 max-w-md text-center"><h2 class="text-3xl font-bold mb-4">ورود به لابی خصوصی</h2><p class="mb-6">لابی <span id="password-prompt-lobby-name" class="font-bold"></span> نیاز به رمز عبور دارد.</p><form id="enter-password-form" class="space-y-5"><input type="password" id="join-lobby-password-input" placeholder="رمز عبور" class="w-full" required><div class="flex justify-around"><button type="submit" class="classic-btn btn-green-classic">ورود</button><button type="button" id="cancel-join-password-btn" class="classic-btn btn-gray-classic">انصراف</button></div></form><div id="password-prompt-message-box" class="mt-5 hidden"></div></div></div>
    </div>

    <script type="module">
        // ================================================================
        // ============= START: FINAL SCRIPT FOR PHP BACKEND =============
        // ================================================================

        // --- DOM Elements ---
        const allElements = {
            loadingScreen: document.getElementById('loading-screen'),
            authScreen: document.getElementById('auth-screen'),
            mainScreen: document.getElementById('main-screen'),
            lobbyScreen: document.getElementById('lobby-screen'),
            lobbyDetailScreen: document.getElementById('lobby-detail-screen'),
            authForm: document.getElementById('auth-form'),
            phoneNumberInput: document.getElementById('phone-number'),
            displayNameInput: document.getElementById('display-name'),
            displayNameField: document.getElementById('display-name-field'),
            passwordInput: document.getElementById('password'),
            loginToggleBtn: document.getElementById('login-toggle-btn'),
            registerToggleBtn: document.getElementById('register-toggle-btn'),
            submitAuthBtn: document.getElementById('submit-auth-btn'),
            messageBox: document.getElementById('message-box'),
            headerDisplayName: document.getElementById('header-display-name'),
            headerUserId: document.getElementById('header-user-id'),
            headerUserCoins: document.getElementById('header-user-coins'),
            friendlyGameBtn: document.getElementById('friendly-game-btn'),
            ratedGameBtn: document.getElementById('rated-game-btn'),
            backToMainBtn: document.getElementById('back-to-main-btn'),
            lobbiesList: document.getElementById('lobbies-list'),
            addIconBtn: document.getElementById('add-icon-btn'),
            refreshLobbiesBtn: document.getElementById('refresh-lobbies-btn'),
            mainMenuModal: document.getElementById('main-menu-modal'),
            closeMainMenuModalBtn: document.getElementById('close-main-menu-modal-btn'),
            mainMenuLogoutBtn: document.getElementById('main-menu-logout-btn'),
            createLobbyModal: document.getElementById('create-lobby-modal'),
            closeCreateLobbyModalBtn: document.getElementById('close-create-lobby-modal-btn'),
            createLobbyForm: document.getElementById('create-lobby-form'),
            newLobbyNameInput: document.getElementById('new-lobby-name-input'),
            submitCreateLobbyBtn: document.getElementById('submit-create-lobby-btn'),
            createLobbyMessageBox: document.getElementById('create-lobby-message-box'),
            lobbyTypeToggle: document.getElementById('lobby-type-toggle'),
            newLobbyPasswordField: document.getElementById('new-lobby-password-field'),
            newLobbyPasswordInput: document.getElementById('new-lobby-password-input'),
            lobbyMaxPlayersToggle: document.getElementById('lobby-max-players-toggle'),
            customConfirmModal: document.getElementById('custom-confirm-modal'),
            confirmTitle: document.getElementById('confirm-title'),
            confirmMessage: document.getElementById('confirm-message'),
            confirmYesBtn: document.getElementById('confirm-yes-btn'),
            confirmNoBtn: document.getElementById('confirm-no-btn'),
            detailLobbyName: document.getElementById('detail-lobby-name'),
            detailHostName: document.getElementById('detail-host-name'),
            detailPlayerCount: document.getElementById('detail-player-count'),
            playerListContainer: document.getElementById('player-list-container'),
            hostActionsContainer: document.getElementById('host-actions-container'),
            startGameBtn: document.getElementById('start-game-btn'),
            leaveLobbyBtn: document.getElementById('leave-lobby-btn'),
            lobbyChatMessages: document.getElementById('lobby-chat-messages'),
            lobbyChatForm: document.getElementById('lobby-chat-form'),
            lobbyChatInput: document.getElementById('lobby-chat-input'),
            lobbyChatSendBtn: document.getElementById('lobby-chat-send-btn'),
            enterPasswordModal: document.getElementById('enter-password-modal'),
            passwordPromptLobbyName: document.getElementById('password-prompt-lobby-name'),
            enterPasswordForm: document.getElementById('enter-password-form'),
            joinLobbyPasswordInput: document.getElementById('join-lobby-password-input'),
            cancelJoinPasswordBtn: document.getElementById('cancel-join-password-btn'),
            passwordPromptMessageBox: document.getElementById('password-prompt-message-box'),
        };

        // --- State Variables ---
        const API_URL = 'firebase_proxy.php';
        let authMode = 'login'; 
        let currentActiveScreen = allElements.loadingScreen;
        let currentUserData = null;
        let currentLobbyId = null;
        let lobbyToJoin = null;
        let resolveCustomConfirm;
        let lobbyPollingInterval = null;

        // ===============================================
        // =========== CORE API & UI FUNCTIONS ===========
        // ===============================================

        async function apiRequest(action, data = {}) {
            const token = localStorage.getItem('session_token');
            const headers = { 'Content-Type': 'application/json' };
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({ action, ...data })
                });

                if (response.status === 401) {
                    handleLogout();
                    throw new Error("نشست شما منقضی شده است. لطفاً دوباره وارد شوید.");
                }
                
                const responseData = await response.json();
                if (!response.ok) {
                    throw new Error(responseData.error || `خطای سرور: ${response.status}`);
                }
                return responseData;
            } catch (error) {
                console.error(`API Request Failed for action "${action}":`, error);
                throw error;
            }
        }

        function showMessage(element, message, type = 'info') {
            element.textContent = message;
            element.className = 'mt-5 p-3.5 rounded-xl text-center'; // Reset classes
            element.classList.add(
                type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-green-500' : 'bg-blue-500'),
                'text-white'
            );
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        function showConfirm(message, title = 'تایید') {
            return new Promise(resolve => {
                allElements.confirmTitle.textContent = title;
                allElements.confirmMessage.textContent = message;
                allElements.customConfirmModal.classList.remove('hidden');
                resolveCustomConfirm = resolve;
            });
        }

        function setActiveScreen(newScreen) {
            if (currentActiveScreen === newScreen) return;
            
            if (lobbyPollingInterval) {
                clearInterval(lobbyPollingInterval);
                lobbyPollingInterval = null;
            }

            currentActiveScreen.classList.add('page-transition-hidden');
            setTimeout(() => {
                currentActiveScreen.classList.add('hidden');
                currentActiveScreen.classList.remove('page-transition-hidden');
                
                newScreen.classList.remove('hidden');
                newScreen.classList.add('page-transition-visible');
                
                currentActiveScreen = newScreen;
                
                setTimeout(() => newScreen.classList.remove('page-transition-visible'), 10); // Fix for transition
            }, 600);
        }
        
        function formatLobbyName(name) {
            const match = name.match(/^\[#([0-9A-Fa-f]{6})\](.*)/);
            return match ? `<span style="color:#${match[1]};">${match[2].trim()}</span>` : name;
        }

        // ===============================================
        // ============ AUTHENTICATION LOGIC =============
        // ===============================================

        function updateUIForAuthState(user) {
            currentUserData = user;
            if (user) {
                allElements.headerDisplayName.textContent = user.displayName;
                allElements.headerUserId.textContent = `شناسه: ${user.uid.substring(0, 8)}...`;
                allElements.headerUserCoins.textContent = (user.coins || 0).toLocaleString('fa-IR');
                localStorage.setItem(`theme_${user.uid}`, user.theme || 'classic');
                applyTheme(user.theme || 'classic');
            } else {
                localStorage.removeItem('session_token');
                allElements.headerDisplayName.textContent = 'کاربر مهمان';
                allElements.headerUserId.textContent = 'وارد نشده';
                allElements.headerUserCoins.textContent = '---';
                currentLobbyId = null;
                applyTheme('classic');
            }
        }

        async function handleLogin(phoneNumber, password) {
            allElements.submitAuthBtn.disabled = true;
            try {
                const result = await apiRequest('login', { phoneNumber, password });
                localStorage.setItem('session_token', result.token);
                updateUIForAuthState(result.user);
                setActiveScreen(allElements.mainScreen);
            } catch (error) {
                showMessage(allElements.messageBox, error.message, 'error');
            } finally {
                allElements.submitAuthBtn.disabled = false;
            }
        }

        async function handleRegister(phoneNumber, password, displayName) {
            allElements.submitAuthBtn.disabled = true;
            try {
                await apiRequest('register', { phoneNumber, password, displayName });
                showMessage(allElements.messageBox, "ثبت نام موفق بود! اکنون می‌توانید وارد شوید.", 'success');
                allElements.loginToggleBtn.click(); // Switch to login view
            } catch (error) {
                showMessage(allElements.messageBox, error.message, 'error');
            } finally {
                allElements.submitAuthBtn.disabled = false;
            }
        }

        async function handleLogout() {
            if (localStorage.getItem('session_token')) {
                try { await apiRequest('logout'); } catch (e) { /* Ignore */ }
            }
            updateUIForAuthState(null);
            setActiveScreen(allElements.authScreen);
        }
        
        async function checkSession() {
             const token = localStorage.getItem('session_token');
             if (token) {
                 try {
                     const result = await apiRequest('getUser');
                     updateUIForAuthState(result.user);
                     setActiveScreen(allElements.mainScreen);
                 } catch (error) {
                     updateUIForAuthState(null);
                     setActiveScreen(allElements.authScreen);
                 }
             } else {
                 updateUIForAuthState(null);
                 setActiveScreen(allElements.authScreen);
             }
        }

        // ===============================================
        // ================= LOBBY LOGIC =================
        // ===============================================
        
        async function fetchAndRenderLobbies() {
            try {
                const lobbies = await apiRequest('getLobbies');
                allElements.lobbiesList.innerHTML = '';
                const lobbyArray = Object.values(lobbies || {});
                if (lobbyArray.length === 0) {
                    allElements.lobbiesList.innerHTML = '<p>هیچ لابی فعالی یافت نشد.</p>';
                    return;
                }
                lobbyArray.forEach(lobby => {
                    const playerCount = lobby.players ? Object.keys(lobby.players).length : 0;
                    const maxPlayers = lobby.gameSettings?.maxPlayers || 4;
                    const isFull = playerCount >= maxPlayers;
                    const isHost = currentUserData && lobby.hostId === currentUserData.uid;

                    const lobbyItem = document.createElement('div');
                    lobbyItem.className = 'lobby-item mb-3 w-full';
                    lobbyItem.innerHTML = `
                        <div>
                            <h3>${formatLobbyName(lobby.name)}</h3>
                            <p>سازنده: ${lobby.hostName || 'ناشناس'} | بازیکنان: ${playerCount}/${maxPlayers}</p>
                        </div>
                        <div class="lobby-actions">
                            ${isHost
                                ? `<button data-lobby-id="${lobby.id}" class="view-my-lobby-btn classic-btn btn-green-classic">مدیریت</button>
                                   <button data-lobby-id="${lobby.id}" class="close-lobby-btn classic-btn btn-red-classic">بستن</button>`
                                : `<button data-lobby-id="${lobby.id}" data-lobby-type="${lobby.type}" data-lobby-name="${lobby.name}" class="join-lobby-btn classic-btn btn-blue-classic" ${isFull ? 'disabled' : ''}>${isFull ? 'پر' : 'ورود'}</button>`
                            }
                        </div>`;
                    allElements.lobbiesList.appendChild(lobbyItem);
                });
            } catch (error) {
                showMessage(allElements.messageBox, error.message, 'error');
            }
        }
        
        function startLobbyPolling(lobbyId) {
            if (lobbyPollingInterval) clearInterval(lobbyPollingInterval);
            const poll = () => fetchAndRenderLobbyDetails(lobbyId);
            poll();
            lobbyPollingInterval = setInterval(poll, 3000);
        }

        async function fetchAndRenderLobbyDetails(lobbyId) {
            if (currentActiveScreen !== allElements.lobbyDetailScreen || !lobbyId) {
                 if (lobbyPollingInterval) clearInterval(lobbyPollingInterval);
                 return;
            }
            try {
                const lobby = await apiRequest('getLobbyDetails', { lobbyId });
                if (!lobby) {
                    showMessage(allElements.messageBox, "لابی بسته شد.", "info");
                    setActiveScreen(allElements.lobbyScreen);
                    fetchAndRenderLobbies();
                    return;
                }
                if (!lobby.players || !lobby.players[currentUserData.uid]) {
                    showMessage(allElements.messageBox, "شما از لابی حذف شدید.", "warning");
                    setActiveScreen(allElements.lobbyScreen);
                    fetchAndRenderLobbies();
                    return;
                }

                const isHost = currentUserData.uid === lobby.hostId;
                allElements.detailLobbyName.innerHTML = formatLobbyName(lobby.name);
                allElements.detailHostName.textContent = `سازنده: ${lobby.hostName}`;
                const playerCount = Object.keys(lobby.players).length;
                allElements.detailPlayerCount.textContent = `بازیکنان: ${playerCount}/${lobby.gameSettings.maxPlayers}`;

                allElements.playerListContainer.innerHTML = Object.entries(lobby.players).map(([uid, data]) => `
                    <div class="player-list-item ${uid === lobby.hostId ? 'is-host' : ''}">
                        <span>${uid === lobby.hostId ? '(سازنده)' : ''} ${data.displayName}</span>
                        ${(isHost && uid !== currentUserData.uid) ? `<button class="kick-player-btn" data-uid="${uid}" data-name="${data.displayName}">اخراج</button>` : ''}
                    </div>`).join('');
                
                allElements.lobbyChatMessages.innerHTML = Object.values(lobby.messages || {}).map(msg => `
                    <div class="chat-message ${msg.senderUid === currentUserData.uid ? 'current-user' : ''}">
                        <span class="sender-name">${msg.senderName}</span><p>${msg.text}</p>
                    </div>`).join('');
                allElements.lobbyChatMessages.scrollTop = allElements.lobbyChatMessages.scrollHeight;

                allElements.hostActionsContainer.style.display = isHost ? 'flex' : 'none';
                allElements.leaveLobbyBtn.classList.toggle('hidden', isHost);
                if(isHost) allElements.startGameBtn.disabled = playerCount < lobby.gameSettings.maxPlayers;

            } catch (error) {
                console.error("Polling error:", error);
                if (lobbyPollingInterval) clearInterval(lobbyPollingInterval);
            }
        }

        // ===============================================
        // =============== EVENT LISTENERS ===============
        // ===============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkSession, 2500); // Wait for loading animation
        });

        allElements.authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const phone = allElements.phoneNumberInput.value;
            const pass = allElements.passwordInput.value;
            if (authMode === 'login') {
                handleLogin(phone, pass);
            } else {
                handleRegister(phone, pass, allElements.displayNameInput.value);
            }
        });

        allElements.loginToggleBtn.addEventListener('click', () => {
            authMode = 'login';
            allElements.displayNameField.classList.add('hidden');
            allElements.submitAuthBtn.textContent = 'ورود';
        });

        allElements.registerToggleBtn.addEventListener('click', () => {
            authMode = 'register';
            allElements.displayNameField.classList.remove('hidden');
            allElements.submitAuthBtn.textContent = 'ثبت نام';
        });
        
        allElements.friendlyGameBtn.addEventListener('click', () => {
            setActiveScreen(allElements.lobbyScreen);
            fetchAndRenderLobbies();
        });

        allElements.backToMainBtn.addEventListener('click', () => setActiveScreen(allElements.mainScreen));
        allElements.addIconBtn.addEventListener('click', () => allElements.createLobbyModal.classList.remove('hidden'));
        allElements.closeCreateLobbyModalBtn.addEventListener('click', () => allElements.createLobbyModal.classList.add('hidden'));
        allElements.refreshLobbiesBtn.addEventListener('click', fetchAndRenderLobbies);
        
        allElements.mainMenuLogoutBtn.addEventListener('click', async () => {
            if (await showConfirm("آیا برای خروج مطمئن هستید؟")) {
                handleLogout();
            }
        });
        
        allElements.createLobbyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const result = await apiRequest('createLobby', {
                    name: allElements.newLobbyNameInput.value,
                    type: allElements.createLobbyForm['lobby-type'].value,
                    password: allElements.newLobbyPasswordInput.value,
                    maxPlayers: parseInt(allElements.createLobbyForm['lobby-max-players'].value)
                });
                currentLobbyId = result.lobbyId;
                allElements.createLobbyModal.classList.add('hidden');
                setActiveScreen(allElements.lobbyDetailScreen);
                startLobbyPolling(currentLobbyId);
            } catch (error) {
                showMessage(allElements.createLobbyMessageBox, error.message, 'error');
            }
        });
        
        allElements.lobbiesList.addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;
            const { lobbyId, lobbyType, lobbyName } = btn.dataset;
            
            if (btn.classList.contains('join-lobby-btn')) {
                if(lobbyType === 'private') {
                    lobbyToJoin = { id: lobbyId, name: lobbyName };
                    allElements.passwordPromptLobbyName.textContent = lobbyName;
                    allElements.enterPasswordModal.classList.remove('hidden');
                } else {
                    apiRequest('joinLobby', { lobbyId }).then(() => {
                        currentLobbyId = lobbyId;
                        setActiveScreen(allElements.lobbyDetailScreen);
                        startLobbyPolling(lobbyId);
                    }).catch(err => showMessage(allElements.messageBox, err.message, 'error'));
                }
            } else if (btn.classList.contains('view-my-lobby-btn')) {
                currentLobbyId = lobbyId;
                setActiveScreen(allElements.lobbyDetailScreen);
                startLobbyPolling(lobbyId);
            } else if (btn.classList.contains('close-lobby-btn')) {
                showConfirm("آیا لابی را برای همه ببندم؟").then(async confirmed => {
                    if(confirmed) {
                        try { await apiRequest('closeLobby', { lobbyId }); fetchAndRenderLobbies(); }
                        catch(err) { showMessage(allElements.messageBox, err.message, 'error'); }
                    }
                });
            }
        });
        
        allElements.enterPasswordForm.addEventListener('submit', async e => {
            e.preventDefault();
            try {
                await apiRequest('joinLobby', { lobbyId: lobbyToJoin.id, password: allElements.joinLobbyPasswordInput.value });
                currentLobbyId = lobbyToJoin.id;
                allElements.enterPasswordModal.classList.add('hidden');
                setActiveScreen(allElements.lobbyDetailScreen);
                startLobbyPolling(currentLobbyId);
            } catch (err) {
                showMessage(allElements.passwordPromptMessageBox, err.message, 'error');
            }
        });

        allElements.lobbyChatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = allElements.lobbyChatInput.value.trim();
            if(text) {
                allElements.lobbyChatInput.value = '';
                try { await apiRequest('sendMessage', { lobbyId: currentLobbyId, text }); }
                catch (err) { /* The polling will show the error implicitly */ }
            }
        });

        allElements.leaveLobbyBtn.addEventListener('click', () => {
             showConfirm("آیا میخواهید از لابی خارج شوید؟").then(async confirmed => {
                 if(confirmed) {
                     try { await apiRequest('leaveLobby', { lobbyId: currentLobbyId }); setActiveScreen(allElements.lobbyScreen); fetchAndRenderLobbies(); }
                     catch(err) { showMessage(allElements.messageBox, err.message, 'error'); }
                 }
             });
        });
        
        allElements.playerListContainer.addEventListener('click', e => {
            const btn = e.target.closest('.kick-player-btn');
            if(btn) {
                showConfirm(`آیا بازیکن "${btn.dataset.name}" اخراج شود؟`).then(async confirmed => {
                    if (confirmed) {
                        try { await apiRequest('kickPlayer', { lobbyId: currentLobbyId, playerUid: btn.dataset.uid }); }
                        catch (err) { showMessage(allElements.messageBox, err.message, 'error'); }
                    }
                });
            }
        });

    </script>
</body>
</html>
